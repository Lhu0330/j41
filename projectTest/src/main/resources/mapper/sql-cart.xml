<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bitc.mapper.JMapper">
	<select id="selectCartList" resultType="com.bitc.dto.JDto">
		<![CDATA[
			SELECT
				product_idx, product_name, cart_qty, (product_price * cart_qty) AS product_price,
				delivery_cost, checked_yn
			FROM
				product
			WHERE
			    cart_qty > 0	
			ORDER BY
				product_idx DESC
			
		]]>
	</select>
	
	<select id="selectPayList" resultType="com.bitc.dto.JDto">
		<![CDATA[
			SELECT
				product_idx, product_name, cart_qty, (product_price * cart_qty) AS product_price,
				delivery_cost, checked_yn
			FROM
				product
			WHERE
			    cart_qty > 0
			AND
			    checked_yn = 'Y'	
			ORDER BY
				product_idx DESC
			
		]]>
	</select>

	<select id="selectSuccessList" resultType="com.bitc.dto.JDto">
		<![CDATA[
			SELECT
				product_idx, product_name, success_qty, product_price, delivery_cost, checked_yn
			FROM
				product
			WHERE
			    success_qty > 0	
			ORDER BY
				product_idx DESC
			
		]]>
	</select>
	
	<select id="selectCostCalculate" resultType="com.bitc.dto.JDto">
		<![CDATA[
			SELECT
				SUM(product_price * cart_qty) AS bs_cost, MAX(delivery_cost) AS ds_cost,
				(SUM(product_price * cart_qty) + MAX(delivery_cost)) AS final_cost
			FROM
				product
			WHERE
			    cart_qty > 0
			AND
			    checked_yn = 'Y'
			
		]]>
	</select>

	<insert id="insertCart" parameterType="com.bitc.dto.JDto">
		<![CDATA[
			INSERT INTO
				product (product_name, cart_qty, product_price, delivery_cost)
			VALUES
				(#{productName}, #{cartQty}, #{productPrice}, #{deliveryCost})
		]]>
	</insert>

	<update id="deleteCart" parameterType="int">
		<![CDATA[
			UPDATE
				product
			SET
				cart_qty = 0
			WHERE
				product_idx = #{productIdx}
		]]>
	</update>
	
	<update id="checkedCart" parameterType="com.bitc.dto.JDto">
		<![CDATA[
			UPDATE
				product
			SET
				checked_yn = 'Y'
			WHERE
				product_idx = #{productIdx}
		]]>
	</update>
	
	<update id="checkedNotCart" parameterType="com.bitc.dto.JDto">
		<![CDATA[
			UPDATE
				product
			SET
				checked_yn = 'N'
			WHERE
				product_idx = #{productIdx}
		]]>
	</update>

	<update id="updateCart" parameterType="com.bitc.dto.JDto">
		<![CDATA[
			UPDATE
				product
			SET
				product_name = #{productName}, cart_qty = #{cartQty}, product_price = #{productPrice}, delivery_cost = #{deliveryCost}
			WHERE
				product_idx = #{productIdx}
		]]>
	</update>

	<update id="updateSuccess" parameterType="com.bitc.dto.JDto">
		<![CDATA[
			UPDATE
				product
			SET
				success_qty = success_qty + cart_qty, product_stock_cnt = product_stock_cnt - cart_qty, cart_qty = 0
			WHERE
				cart_qty > 0
			AND
			    checked_yn = 'Y'	
		]]>
	</update>
</mapper >
